<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CtoPlayer</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- LOGIN VIEW -->
  <div id="login-view" class="view active">
    <div class="login-card">
      <div class="logo">
        <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
          <rect width="40" height="40" rx="10" fill="#2563eb"/>
          <path d="M14 12v16l14-8z" fill="#fff"/>
        </svg>
        <h1>CtoPlayer</h1>
      </div>
      <p class="subtitle">Reprodutor IPTV</p>

      <div class="login-tabs">
        <button class="login-tab active" data-tab="m3u">M3U Playlist</button>
        <button class="login-tab" data-tab="xtream">Xtream Codes</button>
      </div>

      <form id="m3u-form" class="login-form">
        <input type="url" id="m3u-url" placeholder="URL da playlist M3U" required autocomplete="url">
        <button type="submit" class="btn-primary">
          <span class="btn-text">Carregar Playlist</span>
          <span class="btn-loading" hidden>Carregando...</span>
        </button>
        <div class="progress-info" hidden>
          <div class="progress-bar"><div class="progress-fill"></div></div>
          <span class="progress-text"></span>
        </div>
      </form>

      <form id="xtream-form" class="login-form" hidden>
        <input type="url" id="xtream-server" placeholder="URL do Servidor (http://...)" required>
        <input type="text" id="xtream-user" placeholder="Usuário" required autocomplete="username">
        <input type="password" id="xtream-pass" placeholder="Senha" required autocomplete="current-password">
        <button type="submit" class="btn-primary">
          <span class="btn-text">Conectar</span>
          <span class="btn-loading" hidden>Conectando...</span>
        </button>
        <div class="progress-info" hidden>
          <div class="progress-bar"><div class="progress-fill"></div></div>
          <span class="progress-text"></span>
        </div>
      </form>

      <div id="login-error" class="error-msg" hidden></div>

      <p class="open-source-link">Projeto Open Source: <a href="https://github.com/ctoveloz/CTO-Player" target="_blank" rel="noopener">github.com/ctoveloz/CTO-Player</a></p>
    </div>
  </div>

  <!-- DASHBOARD VIEW -->
  <div id="dashboard-view" class="view">
    <header class="topbar">
      <div class="topbar-left">
        <button id="btn-back-login" class="btn-icon" title="Voltar">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path d="M15 10H5m0 0l4-4m-4 4l4 4" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></svg>
        </button>
        <span class="topbar-title">CtoPlayer</span>
      </div>
      <div class="topbar-tabs">
        <button class="tab active" data-type="live">TV ao Vivo</button>
        <button class="tab" data-type="movies">Filmes</button>
        <button class="tab" data-type="series">Séries</button>
      </div>
      <div class="topbar-right">
        <div id="sort-wrapper" class="sort-wrapper">
          <select id="sort-select">
            <option value="newest">Últimos adicionados</option>
            <option value="oldest">Primeiros adicionados</option>
            <option value="az">A - Z</option>
            <option value="za">Z - A</option>
          </select>
        </div>
        <input type="search" id="search-input" placeholder="Buscar..." autocomplete="off">
        <button id="btn-settings" class="btn-icon" title="Configurações">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
        </button>
        <button id="btn-logout" class="btn-icon btn-logout" title="Sair">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
        </button>
      </div>
    </header>

    <div class="dashboard-body">
      <aside id="sidebar">
        <button class="cat-item active" data-cat="all">Todas</button>
      </aside>
      <main id="content-area">
        <div id="content-grid" class="grid"></div>
        <div id="empty-state" class="empty" hidden>Nenhum item encontrado</div>
        <div id="loading-state" class="loading" hidden>
          <div class="spinner"></div>
          <p>Carregando conteúdo...</p>
        </div>
      </main>
    </div>
  </div>

  <!-- SERIES DETAIL VIEW -->
  <div id="series-view" class="view">
    <header class="topbar">
      <div class="topbar-left">
        <button id="btn-back-dashboard" class="btn-icon" title="Voltar">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path d="M15 10H5m0 0l4-4m-4 4l4 4" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></svg>
        </button>
        <span id="series-title" class="topbar-title"></span>
      </div>
    </header>
    <div class="series-body">
      <div id="series-seasons"></div>
    </div>
  </div>

  <!-- SETTINGS VIEW -->
  <div id="settings-view" class="view">
    <header class="topbar">
      <div class="topbar-left">
        <button id="btn-back-settings" class="btn-icon" title="Voltar">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path d="M15 10H5m0 0l4-4m-4 4l4 4" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></svg>
        </button>
        <span class="topbar-title">Configurações</span>
      </div>
    </header>
    <div class="settings-body">
      <form id="settings-form" class="settings-card">
        <h2 class="settings-section-title">Reprodução de Séries</h2>

        <div class="setting-item">
          <div class="setting-info">
            <label for="setting-skip-credits">Pular créditos (segundos antes do fim)</label>
            <p class="setting-desc">Quando faltarem X segundos para o fim do episódio, o próximo episódio será iniciado automaticamente. Use 0 para desativar.</p>
          </div>
          <input type="number" id="setting-skip-credits" min="0" max="300" step="5" value="0" class="setting-input">
        </div>

        <button type="submit" class="btn-primary">Salvar Configurações</button>
      </form>

      <div class="settings-card">
        <h2 class="settings-section-title">Playlist</h2>
        <div class="setting-item">
          <div class="setting-info">
            <label>Atualizar lista</label>
            <p class="setting-desc">Baixa novamente a playlist do servidor para atualizar canais, filmes e séries. A lista também é atualizada automaticamente ao abrir o app.</p>
          </div>
          <button id="btn-refresh" class="btn-primary btn-refresh">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/></svg>
            <span id="btn-refresh-text">Atualizar</span>
          </button>
        </div>
        <div id="refresh-progress" class="refresh-progress" hidden>
          <div class="progress-bar"><div id="refresh-progress-fill" class="progress-fill"></div></div>
          <span id="refresh-status">Atualizando...</span>
        </div>
      </div>
    </div>
  </div>

  <!-- PLAYER VIEW -->
  <div id="player-view" class="view">
    <div class="player-topbar">
      <button id="btn-back-player" class="btn-icon" title="Voltar">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path d="M15 10H5m0 0l4-4m-4 4l4 4" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></svg>
      </button>
      <span id="player-title" class="player-name"></span>
      <div id="ep-nav-buttons" class="ep-nav" hidden>
        <button id="btn-prev-ep" class="btn-icon btn-ep-nav" title="Episodio anterior">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg>
        </button>
        <button id="btn-next-ep" class="btn-icon btn-ep-nav" title="Proximo episodio">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M6 18l8.5-6L6 6v12zm10-12v12h2V6z"/></svg>
        </button>
      </div>
    </div>
    <video id="video-player" controls autoplay></video>
    <div id="player-error" class="player-error" hidden>
      <p>Falha ao reproduzir o stream</p>
      <button id="btn-retry" class="btn-primary btn-sm">Tentar novamente</button>
    </div>
    <div id="next-ep-overlay" class="next-ep-overlay" hidden>
      <div class="next-ep-card">
        <span class="next-ep-label">Proximo episodio em <span id="next-ep-countdown">10</span>s</span>
        <span id="next-ep-name" class="next-ep-name"></span>
        <div class="next-ep-actions">
          <button id="btn-next-ep-play" class="btn-primary btn-sm" onclick="playNextEpisode()">Reproduzir agora</button>
          <button id="btn-next-ep-cancel" class="btn-sm btn-cancel" onclick="cancelNextEpisode()">Cancelar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- RESUME DIALOG -->
  <div id="resume-dialog" class="resume-overlay" hidden>
    <div class="resume-card">
      <p class="resume-title">Continuar assistindo?</p>
      <p id="resume-item-name" class="resume-name"></p>
      <p id="resume-time-info" class="resume-time"></p>
      <div class="resume-actions">
        <button id="btn-resume-yes" class="btn-primary btn-sm">Continuar de onde parei</button>
        <button id="btn-resume-no" class="btn-sm btn-cancel">Começar do início</button>
      </div>
    </div>
  </div>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@3/dist/plyr.css">
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/mpegts.js@1/dist/mpegts.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/plyr@3/dist/plyr.polyfilled.js"></script>
  <script src="app.js"></script>
</body>
</html>
